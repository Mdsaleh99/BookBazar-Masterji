
# 🔐 API Key Authentication: Explained Clearly

API keys are widely used to **authorize requests** made by client-side applications to a backend server. They help protect APIs by ensuring only approved users or apps can access certain routes.

---

## 📦 What Is an API Key?

An **API key** is a unique string (usually a long, random token) generated by the backend. It is:
- Bound to a specific user or client app.
- Saved in the database (usually with a reference to the user).
- Sent with every request to access protected routes.

---

## 📤 How is the API Key Sent?

The **client sends the API key in the HTTP request headers**.

### ✅ Standard Header Format

```http
x-api-key: abc123xyz456unique789
```

Here:
- `x-api-key` is a **custom HTTP header**.
- The value (`abc123xyz456unique789`) is the unique API key.

### ✅ What is `req.headers`?

In Express.js (Node.js backend), you access HTTP headers using `req.headers`.

```js
const apiKey = req.headers['x-api-key'];
```

This reads the `x-api-key` header sent by the client.

---

## ✅ Backend Flow (Express.js)

### 1. **Generate and Save API Key**

```js
const crypto = require("crypto");
const randomKey = crypto.randomBytes(32).toString("hex");

await ApiKey.create({
  key: randomKey,
  userId: req.user._id,
});
res.json({ apiKey: randomKey });
```

- `crypto.randomBytes(32)` generates a secure random key.
- It is stored in the database associated with the user.

### 2. **Middleware to Verify API Key**

```js
const verifyApiKey = async (req, res, next) => {
  const apiKey = req.headers['x-api-key'];
  if (!apiKey) return res.status(403).json({ message: "Missing API key" });

  const keyDoc = await ApiKey.findOne({ key: apiKey });
  if (!keyDoc) return res.status(403).json({ message: "Invalid API key" });

  req.apiUser = keyDoc.userId; // Optional: attach user ID for later use
  next();
};
```

Apply this middleware to routes like `/books`, `/orders`, etc.

---

## 🚀 Frontend Usage (Axios Example)

```js
axios.get("/books", {
  headers: {
    "x-api-key": "abc123xyz456unique789"
  }
});
```

- The API key is **not stored in `req.headers` manually**.
- It must be sent **in each request from the frontend**.

You can also set it globally:

```js
axios.defaults.headers.common['x-api-key'] = apiKey;
```

---

## 🔐 Security Notes

- Never expose your API key generation logic to the frontend.
- Treat API keys like passwords — **don't commit them to version control**.
- Expire/revoke keys if you detect abuse.

---

## 🧾 Summary

| Concept | Explanation |
|--------|-------------|
| `req.headers` | Backend object that contains all incoming request headers |
| `x-api-key` | Custom header key used to send API key |
| Who sends it? | Client (frontend, Postman, etc.) |
| Who reads it? | Backend (`req.headers['x-api-key']`) |
| Where is it stored? | In the database, linked to the user |

---

Happy building secure APIs! 🔐🚀
